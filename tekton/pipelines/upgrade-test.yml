---
apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: mas-upgrade-test
spec:
  params:
    - name: pipelines_namespace
      type: string
      description: Namespace where pipelines are installed

    # Install & Upgrade Parameters
    - name: cli_version
      type: string
      description: Version of the IBM MAS CLI image to use
      default: latest
    - name: artifactory_username
      type: string
      description: Required to install development MAS catalogs
      default: ""
    - name: artifactory_apikey
      type: string
      description: Required to install development MAS catalogs
      default: ""
    - name: storage_class_rwo
      type: string
      description: ReadWriteOnce storage class
      default: ""
    - name: storage_class_rwx
      type: string
      description: ReadWriteMany storage class
      default: ""
    - name: ibm_entitlement_key
      type: string
      description: IBM Entitlement Key
    - name: common_services_catalog_source
      type: string
      description: ""
      default: ""
    - name: sls_license_id
      type: string
      description: ""
    - name: sls_license_file
      type: string
      description: ""
    - name: sls_mongodb_cfg_file
      type: string
      description: ""
      default: /workspace/configs/mongo-mongoce.yml
    - name: source_sls_catalog_source
      type: string
      description: ""
      default: ""
    - name: target_sls_catalog_source
      type: string
      description: ""
      default: ""
    - name: source_sls_channel
      type: string
      description: ""
      default: ""
    - name: target_sls_channel
      type: string
      description: ""
      default: ""
    - name: sls_icr_cp
      type: string
      description: ""
      default: ""
    - name: sls_icr_cpopen
      type: string
      description: ""
      default: ""
    - name: sls_entitlement_username
      type: string
      description: ""
      default: ""
    - name: sls_entitlement_key
      type: string
      description: Override IBM Entitlement key for SLS installation
      default: ""
    - name: mongodb_storage_class
      type: string
      description: ""
      default: ""
    - name: mongodb_replicas
      type: string
      description: Optional configuration for mongodb replicas
      default: ""
    - name: mongodb_cpu_requests
      type: string
      description: Optional configuration for mongodb cpu requests
      default: ""
    - name: kafka_namespace
      type: string
      description: ""
      default: ""
    - name: kafka_cluster_name
      type: string
      description: ""
      default: ""
    - name: kafka_cluster_size
      type: string
      description: ""
      default: ""
    - name: kafka_user_name
      type: string
      description: ""
      default: ""
    - name: gpu_namespace
      type: string
      description: Optional. Nvidia gpu namespace
      default: ""
    - name: gpu_channel
      type: string
      description: Optional. Nvidia gpu channel for install and updates
      default: ""
    - name: nfd_namespace
      type: string
      description: Optional. Node feature discovery namespace
      default: ""
    - name: nfd_channel
      type: string
      description: Optional. Node feature discovery channel for install and updates
      default: ""
    - name: db2_meta_storage_accessmode
      type: string
      description: Optional configuration for db2 meta storage access mode
      default: ""
    - name: db2_backup_storage_accessmode
      type: string
      description: Optional configuration for db2 backup storage access mode
      default: ""
    - name: db2_meta_storage_size
      type: string
      description: Storage capacity (metadata)
      default: ""
    - name: db2_backup_storage_size
      type: string
      description: Storage capacity (backup)
      default: ""
    - name: db2_logs_storage_size
      type: string
      description: Storage capacity (logs)
      default: ""
    - name: db2_temp_storage_size
      type: string
      description: Storage capacity (temp)
      default: ""
    - name: db2_data_storage_size
      type: string
      description: Storage capacity (data)
      default: ""
    - name: db2_cpu_requests
      type: string
      description: Optional configuration for db2 cpu requests
      default: ""
    - name: db2_cpu_limits
      type: string
      description: Optional configuration for mongodb cpu limits
      default: ""
    - name: cpd_operators_namespace
      type: string
      description: ""
      default: ""
    - name: cpd_instance_namespace
      type: string
      description: ""
      default: ""
    - name: cpd_primary_storage_class
      type: string
      description: ""
      default: ""
    - name: cpd_metadata_storage_class
      type: string
      description: ""
      default: ""
    - name: source_cpd_product_version
      type: string
      description: ""
    - name: target_cpd_product_version
      type: string
      description: ""
    - name: cpd_wd_storage_class
      type: string
      description: ""
      default: ""
    - name: cpd_wml_storage_class
      type: string
      description: ""
      default: ""
    - name: cpd_spark_storage_class
      type: string
      description: ""
      default: ""
    - name: cpd_wsl_storage_class
      type: string
      description: ""
      default: ""
    - name: uds_contact_email
      type: string
      description: ""
    - name: uds_contact_firstname
      type: string
      description: ""
    - name: uds_contact_lastname
      type: string
      description: ""
    - name: appconnect_channel
      type: string
      description: ""
      default: ""
    - name: appconnect_dashboard_version
      type: string
      description: ""
      default: ""
    - name: appconnect_dashboard_name
      type: string
      description: ""
      default: ""
    - name: appconnect_license_id
      type: string
      description: ""
      default: ""
    - name: appconnect_storage_class
      type: string
      description: ""
      default: ""
    - name: cos_type
      type: string
      description: COS Provider (ibm or ocs)
    - name: ibmcloud_apikey
      type: string
      description: API Key used to create COS instance in IBM Cloud
    - name: uds_event_scheduler_frequency
      type: string
      description: ""
      default: ""
    - name: mas_segment_key
      type: string
      description: ""
      default: ""
    - name: dns_provider
      type: string
      description: ""
      default: ""
    - name: cloudflare_email
      type: string
      description: ""
      default: ""
    - name: cloudflare_apitoken
      type: string
      description: ""
      default: ""
    - name: cloudflare_zone
      type: string
      description: ""
      default: ""
    - name: cloudflare_subdomain
      type: string
      description: ""
      default: ""
    - name: cis_email
      type: string
      description: ""
      default: ""
    - name: cis_apikey
      type: string
      description: ""
      default: ""
    - name: cis_crn
      type: string
      description: ""
      default: ""
    - name: cis_subdomain
      type: string
      description: ""
      default: ""
    - name: mas_instance_id
      type: string
      description: ""
    - name: source_mas_channel
      type: string
      description: ""
    - name: target_mas_channel
      type: string
      description: ""
    - name: source_mas_catalog_source
      type: string
      description: ""
      default: ibm-operator-catalog
    - name: target_mas_catalog_source
      type: string
      description: ""
      default: ibm-operator-catalog
    - name: mas_catalog_version
      type: string
      description: ""
      default: v8-amd64
    - name: mas_domain
      type: string
      description: ""
      default: ""
    - name: mas_cluster_issuer
      type: string
      description: ""
      default: ""
    - name: mas_icr_cp
      type: string
      description: ""
      default: ""
    - name: mas_icr_cpopen
      type: string
      description: ""
      default: ""
    - name: mas_entitlement_username
      type: string
      description: ""
      default: ""
    - name: mas_annotations
      type: string
      description: ""
      default: ""
    - name: mas_entitlement_key
      type: string
      description: Override IBM Entitlement key for MAS installation
      default: ""
    - name: mas_customize_scaling
      type: string
      description: Workload Scaling Custom ConfigMap Name
      default: ""
    - name: mas_workspace_id
      type: string
      description: Workspace ID used to configure all applications
      default: masdev
    - name: mas_workspace_name
      type: string
      description: Workspace Name used when setting up the workspace
      default: MAS Development
    - name: mas_appws_components
      type: string
      description: Manage components to configure in the workspace
      default: base=latest,health=latest
    - name: mas_app_settings_aio_flag
      type: string
      description: Flag indicating if Asset Investment Optimization (AIO) resource must be loaded or not. It can be loaded only when Optimizer application is installed.
      default: ""
    - name: mas_app_settings_demodata
      type: string
      description: Flag indicating if manage demodata should be loaded or not
      default: ""
    - name: mas_app_plan_optimizer
      type: string
      description: Configure install plan of Optimizer application (full or limited)
      default: full
    - name: wml_instance_id
      type: string
      description: wml instance to be configured in Predict
      default: ""
    - name: wml_url
      type: string
      description: Url to access wml services
      default: ""
    - name: wml_version
      type: string
      description: product version if cpd_product_version is not set
      default: ""
    - name: predict_deployment_size
      type: string
      description: controls the workload size of predict containers
      default: ""
    - name: source_mas_app_channel_iot
      type: string
      description: Subscription channel for IoT application operator
      default: ""
    - name: target_mas_app_channel_iot
      type: string
      description: Subscription channel for IoT application operator
      default: ""
    - name: source_mas_app_channel_manage
      type: string
      description: Subscription channel for Manage application operator
      default: ""
    - name: target_mas_app_channel_manage
      type: string
      description: Subscription channel for Manage application operator
      default: ""
    - name: source_mas_app_channel_monitor
      type: string
      description: Subscription channel for Monitor application operator
      default: ""
    - name: target_mas_app_channel_monitor
      type: string
      description: Subscription channel for Monitor application operator
      default: ""
    - name: source_mas_app_channel_optimizer
      type: string
      description: Subscription channel for Optimizer application operator
      default: ""
    - name: target_mas_app_channel_optimizer
      type: string
      description: Subscription channel for Optimizer application operator
      default: ""
    - name: source_mas_app_channel_predict
      type: string
      description: Subscription channel for Predict application operator
      default: ""
    - name: target_mas_app_channel_predict
      type: string
      description: Subscription channel for Predict application operator
      default: ""
    - name: source_mas_app_channel_safety
      type: string
      description: Subscription channel for Safety application operator
      default: ""
    - name: target_mas_app_channel_safety
      type: string
      description: Subscription channel for Safety application operator
      default: ""
    - name: source_mas_app_channel_hputilities
      type: string
      description: Subscription channel for Health & Predict - Utilities application operator
      default: ""
    - name: target_mas_app_channel_hputilities
      type: string
      description: Subscription channel for Health & Predict - Utilities application operator
      default: ""
    - name: source_mas_app_channel_assist
      type: string
      description: Subscription channel for Assist application operator
      default: ""
    - name: target_mas_app_channel_assist
      type: string
      description: Subscription channel for Assist application operator
      default: ""
    - name: source_mas_app_channel_visualinspection
      type: string
      description: Subscription channel for MVI application operator
      default: ""
    - name: target_mas_app_channel_visualinspection
      type: string
      description: Subscription channel for MVI application operator
      default: ""
    - name: source_mas_app_source_iot
      type: string
      description: Subscription source for IoT application operator
      default: ibm-operator-catalog
    - name: target_mas_app_source_iot
      type: string
      description: Subscription source for IoT application operator
      default: ibm-operator-catalog
    - name: source_mas_app_source_manage
      type: string
      description: Subscription source for Manage application operator
      default: ibm-operator-catalog
    - name: target_mas_app_source_manage
      type: string
      description: Subscription source for Manage application operator
      default: ibm-operator-catalog
    - name: source_mas_app_source_monitor
      type: string
      description: Subscription source for Monitor application operator
      default: ibm-operator-catalog
    - name: target_mas_app_source_monitor
      type: string
      description: Subscription source for Monitor application operator
      default: ibm-operator-catalog
    - name: source_mas_app_source_optimizer
      type: string
      description: Subscription source for Optimizer application operator
      default: ibm-operator-catalog
    - name: target_mas_app_source_optimizer
      type: string
      description: Subscription source for Optimizer application operator
      default: ibm-operator-catalog
    - name: source_mas_app_source_predict
      type: string
      description: Subscription source for Predict application operator
      default: ibm-operator-catalog
    - name: target_mas_app_source_predict
      type: string
      description: Subscription source for Predict application operator
      default: ibm-operator-catalog
    - name: mas_app_source_safety
      type: string
      description: Subscription source for Safety application operator
      default: ibm-operator-catalog
    - name: source_mas_app_source_hputilities
      type: string
      description: Subscription source for Health & Predict - Utilities application operator
      default: ""
    - name: target_mas_app_source_hputilities
      type: string
      description: Subscription source for Health & Predict - Utilities application operator
      default: ""
    - name: source_mas_app_source_assist
      type: string
      description: Subscription source for Assist application operator
      default: ""
    - name: target_mas_app_source_assist
      type: string
      description: Subscription source for Assist application operator
      default: ""
    - name: source_mas_app_source_visualinspection
      type: string
      description: Subscription source for MVI application operator
      default: ""
    - name: target_mas_app_source_visualinspection
      type: string
      description: Subscription source for MVI application operator
      default: ""
    - name: devops_mongo_uri
      type: string
      description: ""
      default: ""
    - name: devops_build_number
      type: string
      description: ""
      default: ""

    # Test Parameters
    - name: fvt_image_registry
      type: string
      description: ""
    - name: fvt_artifactory_username
      type: string
      description: ""
    - name: fvt_artifactory_apikey
      type: string
      description: ""
    - name: mas_add_catalog
      type: string
      description: ""
    - name: mas_add_channel
      type: string
      description: ""
    - name: ddp_apikey
      type: string
      description: ""
    - name: partium_username
      type: string
      description: ""
    - name: partium_password
      type: string
      description: ""
    - name: devops_cos_crn
      type: string
      description: ""
      default: ""
    - name: fvt_version_core
      type: string
      description: FVT Version - Core
      default: ""
    - name: fvt_version_iot
      type: string
      description: FVT Version - IoT
      default: ""
    - name: fvt_version_safety
      type: string
      description: FVT Version - Safety
      default: ""
    - name: fvt_version_monitor
      type: string
      description: FVT Version - Monitor
      default: ""
    - name: fvt_version_predict
      type: string
      description: FVT Version - Predict
      default: ""
    - name: fvt_version_hputilities
      type: string
      description: FVT Version - Health & Predict Utilities
      default: ""
    - name: fvt_version_visualinspection
      type: string
      description: FVT Version - Visual Inspection
      default: ""
    - name: fvt_version_assist
      type: string
      description: FVT Version - Assist
      default: ""
    - name: fvt_version_optimizer
      type: string
      description: FVT Version - Optimizer
      default: ""
    - name: fvt_version_manage
      type: string
      description: FVT Version - Manage
      default: ""
    - name: fvt_version_health
      type: string
      description: FVT Version - Health
      default: ""
    - name: fvt_version_manage_acm
      type: string
      description: FVT Version - Manage ACM
      default: ""
    - name: fvt_version_manage_aviation
      type: string
      description: FVT Version - Manage Aviation
      default: ""
    - name: fvt_version_manage_hse
      type: string
      description: FVT Version - Manage HSE
      default: ""
    - name: fvt_version_manage_nuclear
      type: string
      description: FVT Version - Manage Nuclear
      default: ""
    - name: fvt_version_manage_serviceprovider
      type: string
      description: FVT Version - Service Provider
      default: ""
    - name: fvt_version_manage_spatial
      type: string
      description: FVT Version - Spatial
      default: ""
    - name: fvt_version_manage_transportation
      type: string
      description: FVT Version - Manage Transportation
      default: ""
    - name: fvt_version_manage_civil
      type: string
      description: FVT Version - Manage Civil Infrastructure
      default: ""
    - name: fvt_version_manage_ic
      type: string
      description: FVT Version - Manage IC
      default: ""
    - name: fvt_version_mobilefoundation
      type: string
      description: FVT Version - Mobile Foundation
      default: ""
    - name: ivt_version_core
      type: string
      description: IVT Version - Core
      default: ""

  tasks:
    - name: install
      params:
        # Pipeline Run Parameters
        - name: pipeline_name
          value: mas-install
        - name: pipelines_namespace
          value: $(params.pipelines_namespace)

        # Install Parameters
        - name: cli_version
          value: $(params.cli_version)
        - name: artifactory_username
          value: $(params.artifactory_username)
        - name: artifactory_apikey
          value: $(params.artifactory_apikey)
        - name: storage_class_rwo
          value: $(params.storage_class_rwo)
        - name: storage_class_rwx
          value: $(params.storage_class_rwx)
        - name: ibm_entitlement_key
          value: $(params.ibm_entitlement_key)
        - name: common_services_catalog_source
          value: $(params.common_services_catalog_source)
        - name: sls_license_id
          value: $(params.sls_license_id)
        - name: sls_license_file
          value: $(params.sls_license_file)
        - name: sls_mongodb_cfg_file
          value: $(params.sls_mongodb_cfg_file)
        - name: sls_catalog_source
          value: $(params.source_sls_catalog_source)
        - name: sls_channel
          value: $(params.source_sls_channel)
        - name: sls_icr_cp
          value: $(params.sls_icr_cp)
        - name: sls_icr_cpopen
          value: $(params.sls_icr_cpopen)
        - name: sls_entitlement_username
          value: $(params.sls_entitlement_username)
        - name: sls_entitlement_key
          value: $(params.sls_entitlement_key)
        - name: mongodb_storage_class
          value: $(params.mongodb_storage_class)
        - name: mongodb_replicas
          value: $(params.mongodb_replicas)
        - name: mongodb_cpu_requests
          value: $(params.mongodb_cpu_requests)
        - name: kafka_namespace
          value: $(params.kafka_namespace)
        - name: kafka_cluster_name
          value: $(params.kafka_cluster_name)
        - name: kafka_cluster_size
          value: $(params.kafka_cluster_size)
        - name: kafka_user_name
          value: $(params.kafka_user_name)
        - name: gpu_namespace
          value: $(params.gpu_namespace)
        - name: gpu_channel
          value: $(params.gpu_channel)
        - name: nfd_namespace
          value: $(params.nfd_namespace)
        - name: nfd_channel
          value: $(params.nfd_channel)
        - name: db2_meta_storage_accessmode
          value: $(params.db2_meta_storage_accessmode)
        - name: db2_backup_storage_accessmode
          value: $(params.db2_backup_storage_accessmode)
        - name: db2_meta_storage_size
          value: $(params.db2_meta_storage_size)
        - name: db2_backup_storage_size
          value: $(params.db2_backup_storage_size)
        - name: db2_logs_storage_size
          value: $(params.db2_logs_storage_size)
        - name: db2_temp_storage_size
          value: $(params.db2_temp_storage_size)
        - name: db2_data_storage_size
          value: $(params.db2_data_storage_size)
        - name: db2_cpu_requests
          value: $(params.db2_cpu_requests)
        - name: db2_cpu_limits
          value: $(params.db2_cpu_limits)
        - name: cpd_operators_namespace
          value: $(params.cpd_operators_namespace)
        - name: cpd_instance_namespace
          value: $(params.cpd_instance_namespace)
        - name: cpd_primary_storage_class
          value: $(params.cpd_primary_storage_class)
        - name: cpd_metadata_storage_class
          value: $(params.cpd_metadata_storage_class)
        - name: cpd_product_version
          value: $(params.source_cpd_product_version)
        - name: cpd_wd_storage_class
          value: $(params.cpd_wd_storage_class)
        - name: cpd_wml_storage_class
          value: $(params.cpd_wml_storage_class)
        - name: cpd_spark_storage_class
          value: $(params.cpd_spark_storage_class)
        - name: cpd_wsl_storage_class
          value: $(params.cpd_wsl_storage_class)
        - name: uds_contact_email
          value: $(params.uds_contact_email)
        - name: uds_contact_firstname
          value: $(params.uds_contact_firstname)
        - name: uds_contact_lastname
          value: $(params.uds_contact_lastname)
        - name: appconnect_channel
          value: $(params.appconnect_channel)
        - name: appconnect_dashboard_version
          value: $(params.appconnect_dashboard_version)
        - name: appconnect_dashboard_name
          value: $(params.appconnect_dashboard_name)
        - name: appconnect_license_id
          value: $(params.appconnect_license_id)
        - name: appconnect_storage_class
          value: $(params.appconnect_storage_class)
        - name: cos_type
          value: $(params.cos_type)
        - name: ibmcloud_apikey
          value: $(params.ibmcloud_apikey)
        - name: uds_event_scheduler_frequency
          value: $(params.uds_event_scheduler_frequency)
        - name: mas_segment_key
          value: $(params.mas_segment_key)
        - name: dns_provider
          value: $(params.dns_provider)
        - name: cloudflare_email
          value: $(params.cloudflare_email)
        - name: cloudflare_apitoken
          value: $(params.cloudflare_apitoken)
        - name: cloudflare_zone
          value: $(params.cloudflare_zone)
        - name: cloudflare_subdomain
          value: $(params.cloudflare_subdomain)
        - name: cis_email
          value: $(params.cis_email)
        - name: cis_apikey
          value: $(params.cis_apikey)
        - name: cis_crn
          value: $(params.cis_crn)
        - name: cis_subdomain
          value: $(params.cis_subdomain)
        - name: mas_instance_id
          value: $(params.mas_instance_id)
        - name: mas_channel
          value: $(params.source_mas_channel)
        - name: mas_catalog_source
          value: $(params.source_mas_catalog_source)
        - name: mas_catalog_version
          value: $(params.mas_catalog_version)
        - name: mas_domain
          value: $(params.mas_domain)
        - name: mas_cluster_issuer
          value: $(params.mas_cluster_issuer)
        - name: mas_icr_cp
          value: $(params.mas_icr_cp)
        - name: mas_icr_cpopen
          value: $(params.mas_icr_cpopen)
        - name: mas_entitlement_username
          value: $(params.mas_entitlement_username)
        - name: mas_annotations
          value: $(params.mas_annotations)
        - name: mas_entitlement_key
          value: $(params.mas_entitlement_key)
        - name: mas_customize_scaling
          value: $(params.mas_customize_scaling)
        - name: mas_workspace_id
          value: $(params.mas_workspace_id)
        - name: mas_workspace_name
          value: $(params.mas_workspace_name)
        - name: mas_appws_components
          value: $(params.mas_appws_components)
        - name: mas_app_settings_aio_flag
          value: $(params.mas_app_settings_aio_flag)
        - name: mas_app_settings_demodata
          value: $(params.mas_app_settings_demodata)
        - name: mas_app_plan_optimizer
          value: $(params.mas_app_plan_optimizer)
        - name: wml_instance_id
          value: $(params.wml_instance_id)
        - name: wml_url
          value: $(params.wml_url)
        - name: wml_version
          value: $(params.wml_version)
        - name: predict_deployment_size
          value: $(params.predict_deployment_size)
        - name: mas_app_channel_iot
          value: $(params.source_mas_app_channel_iot)
        - name: mas_app_channel_manage
          value: $(params.source_mas_app_channel_manage)
        - name: mas_app_channel_monitor
          value: $(params.source_mas_app_channel_monitor)
        - name: mas_app_channel_optimizer
          value: $(params.source_mas_app_channel_optimizer)
        - name: mas_app_channel_predict
          value: $(params.source_mas_app_channel_predict)
        - name: mas_app_channel_safety
          value: $(params.source_mas_app_channel_safety)
        - name: mas_app_channel_hputilities
          value: $(params.source_mas_app_channel_hputilities)
        - name: mas_app_channel_assist
          value: $(params.source_mas_app_channel_assist)
        - name: mas_app_channel_visualinspection
          value: $(params.source_mas_app_channel_visualinspection)
        - name: mas_app_source_iot
          value: $(params.source_mas_app_source_iot)
        - name: mas_app_source_manage
          value: $(params.source_mas_app_source_manage)
        - name: mas_app_source_monitor
          value: $(params.source_mas_app_source_monitor)
        - name: mas_app_source_optimizer
          value: $(params.source_mas_app_source_optimizer)
        - name: mas_app_source_predict
          value: $(params.source_mas_app_source_predict)
        - name: mas_app_source_safety
          value: $(params.mas_app_source_safety)
        - name: mas_app_source_hputilities
          value: $(params.source_mas_app_source_hputilities)
        - name: mas_app_source_assist
          value: $(params.source_mas_app_source_assist)
        - name: mas_app_source_visualinspection
          value: $(params.source_mas_app_source_visualinspection)
        - name: devops_mongo_uri
          value: $(params.devops_mongo_uri)
        - name: devops_build_number
          value: $(params.devops_build_number)
      taskRef:
        kind: Task
        name: mas-install-run-pipeline
    
    - name: test-before
      params:
        # Pipeline Run Parameters
        - name: pipeline_name
          value: mas-fvt-core
        - name: pipelines_namespace
          value: $(params.pipelines_namespace)
        - name: devops_mongo_uri
          value: $(params.devops_mongo_uri)
        - name: devops_build_number
          value: $(params.devops_build_number)
        - name: mas_instance_id
          value: $(params.mas_instance_id)
        - name: mas_channel
          value: $(params.source_mas_channel)
        - name: mas_workspace_id
          value: $(params.mas_workspace_id)
        # MAS Test parameters
        - name: fvt_image_registry
          value: $(params.fvt_image_registry)
        - name: fvt_artifactory_username
          value: $(params.fvt_artifactory_username)
        - name: fvt_artifactory_apikey
          value: $(params.fvt_artifactory_apikey)
        - name: mas_add_catalog
          value: $(params.mas_add_catalog)
        - name: mas_add_channel
          value: $(params.mas_add_channel)
        - name: ddp_apikey
          value: $(params.ddp_apikey)
        - name: partium_username
          value: $(params.partium_username)
        - name: partium_password
          value: $(params.partium_password)
        - name: devops_cos_crn
          value: $(params.devops_cos_crn)
        - name: fvt_version_core
          value: $(params.fvt_version_core)
        - name: fvt_version_iot
          value: $(params.fvt_version_iot)
        - name: fvt_version_safety
          value: $(params.fvt_version_safety)
        - name: fvt_version_monitor
          value: $(params.fvt_version_monitor)
        - name: fvt_version_predict
          value: $(params.fvt_version_predict)
        - name: fvt_version_hputilities
          value: $(params.fvt_version_hputilities)
        - name: fvt_version_visualinspection
          value: $(params.fvt_version_visualinspection)
        - name: fvt_version_assist
          value: $(params.fvt_version_assist)
        - name: fvt_version_optimizer
          value: $(params.fvt_version_optimizer)
        - name: fvt_version_manage
          value: $(params.fvt_version_manage)
        - name: fvt_version_health
          value: $(params.fvt_version_health)
        - name: fvt_version_manage_acm
          value: $(params.fvt_version_manage_acm)
        - name: fvt_version_manage_aviation
          value: $(params.fvt_version_manage_aviation)
        - name: fvt_version_manage_hse
          value: $(params.fvt_version_manage_hse)
        - name: fvt_version_manage_nuclear
          value: $(params.fvt_version_manage_nuclear)
        - name: fvt_version_manage_serviceprovider
          value: $(params.fvt_version_manage_serviceprovider)
        - name: fvt_version_manage_spatial
          value: $(params.fvt_version_manage_spatial)
        - name: fvt_version_manage_transportation
          value: $(params.fvt_version_manage_transportation)
        - name: fvt_version_manage_civil
          value: $(params.fvt_version_manage_civil)
        - name: fvt_version_manage_ic
          value: $(params.fvt_version_manage_ic)
        - name: fvt_version_mobilefoundation
          value: $(params.fvt_version_mobilefoundation)
        - name: ivt_version_core
          value: $(params.ivt_version_core)
      taskRef:
        kind: Task
        name: mas-test-run-pipeline
      runAfter:
        - install
    
    - name: upgrade
      params:
        # Pipeline Run Parameters
        - name: pipeline_name
          value: mas-upgrade
        - name: pipelines_namespace
          value: $(params.pipelines_namespace)
          # MAS Upgrade parameters
        - name: mas_instance_id
          value: $(params.mas_instance_id)
        - name: mas_channel
          value: $(params.target_mas_channel)
        - name: mas_workspace_id
          value: $(params.mas_workspace_id)
        - name: mas_app_channel_iot
          value: $(params.target_mas_app_channel_iot)
        - name: mas_app_channel_manage
          value: $(params.target_mas_app_channel_manage)
        - name: mas_app_channel_monitor
          value: $(params.target_mas_app_channel_monitor)
        - name: mas_app_channel_optimizer
          value: $(params.target_mas_app_channel_optimizer)
        - name: mas_app_channel_predict
          value: $(params.target_mas_app_channel_predict)
        - name: mas_app_channel_hputilities
          value: $(params.target_mas_app_channel_hputilities)
        - name: mas_app_channel_assist
          value: $(params.target_mas_app_channel_assist)
        - name: mas_app_channel_visualinspection
          value: $(params.target_mas_app_channel_visualinspection)
        - name: devops_mongo_uri
          value: $(params.devops_mongo_uri)
        - name: devops_build_number
          value: $(params.devops_build_number)
      taskRef:
        kind: Task
        name: mas-upgrade-run-pipeline
      runAfter:
        - test-before
    
    - name: test-after
      params:
        # Pipeline Run Parameters
        - name: pipeline_name
          value: mas-fvt-core
        - name: pipelines_namespace
          value: $(params.pipelines_namespace)
        - name: devops_mongo_uri
          value: $(params.devops_mongo_uri)
        - name: devops_build_number
          value: $(params.devops_build_number)
        - name: mas_instance_id
          value: $(params.mas_instance_id)
        - name: mas_channel
          value: $(params.target_mas_channel)
        - name: mas_workspace_id
          value: $(params.mas_workspace_id)
        # MAS Test parameters
        - name: fvt_image_registry
          value: $(params.fvt_image_registry)
        - name: fvt_artifactory_username
          value: $(params.fvt_artifactory_username)
        - name: fvt_artifactory_apikey
          value: $(params.fvt_artifactory_apikey)
        - name: mas_add_catalog
          value: $(params.mas_add_catalog)
        - name: mas_add_channel
          value: $(params.mas_add_channel)
        - name: ddp_apikey
          value: $(params.ddp_apikey)
        - name: partium_username
          value: $(params.partium_username)
        - name: partium_password
          value: $(params.partium_password)
        - name: devops_cos_crn
          value: $(params.devops_cos_crn)
        - name: fvt_version_core
          value: $(params.fvt_version_core)
        - name: fvt_version_iot
          value: $(params.fvt_version_iot)
        - name: fvt_version_safety
          value: $(params.fvt_version_safety)
        - name: fvt_version_monitor
          value: $(params.fvt_version_monitor)
        - name: fvt_version_predict
          value: $(params.fvt_version_predict)
        - name: fvt_version_hputilities
          value: $(params.fvt_version_hputilities)
        - name: fvt_version_visualinspection
          value: $(params.fvt_version_visualinspection)
        - name: fvt_version_assist
          value: $(params.fvt_version_assist)
        - name: fvt_version_optimizer
          value: $(params.fvt_version_optimizer)
        - name: fvt_version_manage
          value: $(params.fvt_version_manage)
        - name: fvt_version_health
          value: $(params.fvt_version_health)
        - name: fvt_version_manage_acm
          value: $(params.fvt_version_manage_acm)
        - name: fvt_version_manage_aviation
          value: $(params.fvt_version_manage_aviation)
        - name: fvt_version_manage_hse
          value: $(params.fvt_version_manage_hse)
        - name: fvt_version_manage_nuclear
          value: $(params.fvt_version_manage_nuclear)
        - name: fvt_version_manage_serviceprovider
          value: $(params.fvt_version_manage_serviceprovider)
        - name: fvt_version_manage_spatial
          value: $(params.fvt_version_manage_spatial)
        - name: fvt_version_manage_transportation
          value: $(params.fvt_version_manage_transportation)
        - name: fvt_version_manage_civil
          value: $(params.fvt_version_manage_civil)
        - name: fvt_version_manage_ic
          value: $(params.fvt_version_manage_ic)
        - name: fvt_version_mobilefoundation
          value: $(params.fvt_version_mobilefoundation)
        - name: ivt_version_core
          value: $(params.ivt_version_core)
      taskRef:
        kind: Task
        name: mas-test-run-pipeline
      runAfter:
        - upgrade
