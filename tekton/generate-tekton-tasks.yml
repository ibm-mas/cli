- name: Generate Tekton Tasks
  hosts: localhost
  any_errors_fatal: true
  vars:
    mas_tekton_version: latest

    task_src_dir: src/tasks
    task_target_dir: target/tasks
  tasks:

    # 1. Prepare tmp and target directory for the tasks build
    # -------------------------------------------------------------------------
    - name: Create target directory
      ansible.builtin.file:
        path: "{{ task_target_dir }}"
        state: directory

    # 2. Generate Tasks (Dependencies)
    # -------------------------------------------------------------------------
    - name: Generate Tasks (Dependencies)
      ansible.builtin.template:
        src: "{{ task_src_dir }}/dependencies/{{ item }}.yml.j2"
        dest: "{{ task_target_dir }}/{{ item }}.yaml"
      with_items:
        - arcgis
        - appconnect
        - cert-manager
        - cos
        - cp4d-service
        - cp4d-service-update
        - cp4d
        - db2
        - dro
        - eck
        - grafana
        - ibm-catalogs
        - kafka
        - mongodb
        - nvidia-gpu
        - ocs
        - sls-registry-update
        - sls
        - turbonomic

    # 3. Generate Tasks (AI Service)
    # -------------------------------------------------------------------------
    - name: Generate Tasks (AI Service)
      ansible.builtin.template:
        src: "{{ task_src_dir }}/aiservice/{{ item }}.yml.j2"
        dest: "{{ task_target_dir }}/{{ item }}.yaml"
      with_items:
        - minio
        - aiservice
        - odh
        - aiservice-upgrade

    # 4. Generate Tasks (FVT)
    # -------------------------------------------------------------------------
    - name: Generate Tasks (FVT)
      ansible.builtin.template:
        src: "{{ task_src_dir }}/fvt/{{ item }}.yml.j2"
        dest: "{{ task_target_dir }}/{{ item }}.yaml"
      with_items:
        - aiservice-fvt
        - aiservice-fvt-start-upgrade
        - mas-fvt-assist-desktop
        - mas-fvt-assist
        - mas-fvt-core
        - mas-fvt-components
        - mas-fvt-data-dictionary
        - mas-fvt-deprovision-ocp
        - mas-fvt-deprovision-cos
        - mas-fvt-deprovision-kafka
        - mas-fvt-finalize
        - mas-fvt-pipeline-finish-and-deprovision
        - mas-fvt-iot
        - mas-fvt-manage
        - mas-fvt-mobile-testng
        - mas-fvt-mobile-pytest
        - mas-fvt-manage-directprint
        - mas-fvt-manage-adhoc-report
        - mas-fvt-manage-birt-report
        - mas-fvt-manage-last-phase
        - mas-fvt-manage-pytest
        - mas-fvt-manage-cypress
        - mas-fvt-monitor
        - mas-fvt-run-suite
        - mas-fvt-sls
        - mas-fvt-start-update
        - mas-fvt-start-upgrade
        - mas-fvt-start-uninstall
        - mas-fvt-pre-update
        - mas-fvt-pre-upgrade
        - mas-fvt-post-update

    - name: Generate Tasks (FVT Launchers)
      ansible.builtin.template:
        src: "{{ task_src_dir }}/fvt-launcher/{{ item }}.yml.j2"
        dest: "{{ task_target_dir }}/{{ item }}.yaml"
      with_items:
        - aiservice-launchfvt
        - mas-launchfvt-assist
        - mas-launchfvt-core
        - mas-launchfvt-sls
        - mas-launchfvt-finally
        - mas-launchfvt-iot
        - mas-launchfvt-manage
        - mas-launchfvt-manage-ai
        - mas-launchfvt-manage-is
        - mas-launchfvt-mobile
        - mas-launchfvt-monitor
        - mas-launchfvt-optimizer
        - mas-launchfvt-predict
        - mas-launchfvt-visualinspection
        - mas-launchfvt-upgrade-post
        - mas-launchfvt-upgrade-pre
        - mas-launchfvt-facilities
        - mas-launchivt-manage


    # 5. Generate Tasks (IVT)
    # -------------------------------------------------------------------------
    - name: Generate Tasks (IVT)
      ansible.builtin.template:
        src: "{{ task_src_dir }}/ivt/{{ item }}.yml.j2"
        dest: "{{ task_target_dir }}/{{ item }}.yaml"
      with_items:
        - ivt-core
        - ivt-manage

    # 6. Generate Tasks (Suite)
    # -------------------------------------------------------------------------
    - name: Generate Tasks (Suite)
      ansible.builtin.template:
        src: "{{ task_src_dir }}/{{ item }}.yml.j2"
        dest: "{{ task_target_dir }}/{{ item }}.yaml"
      with_items:
        - gencfg-workspace
        - must-gather
        - suite-app-install
        - suite-app-uninstall
        - suite-app-upgrade
        - suite-app-rollback
        - suite-certs
        - suite-config
        - suite-db2-setup-for-manage
        - suite-db2-setup-for-facilities
        - suite-dns
        - suite-install
        - suite-rollback
        - suite-uninstall
        - suite-upgrade
        - suite-verify

    # 7. Generate Tasks (OCP)
    # -------------------------------------------------------------------------
    - name: Generate Tasks (Suite)
      ansible.builtin.template:
        src: "{{ task_src_dir }}/ocp/{{ item }}.yml.j2"
        dest: "{{ task_target_dir }}/{{ item }}.yaml"
      with_items:
        - ocp-verify
        - ocp-verify-all

    # 8. Generate Tasks (Framework)
    # -------------------------------------------------------------------------
    - name: Generate Tasks (Framework)
      ansible.builtin.template:
        src: "{{ task_src_dir }}/framework/{{ item }}.yml.j2"
        dest: "{{ task_target_dir }}/{{ item }}.yaml"
      with_items:
        - update-configmap
        - update-pipeline-status
        - wait-for-configmap
        - wait-for-configmap-v2
        - wait-for-tekton

    # 9. Generate Tasks (Common)
    # -------------------------------------------------------------------------
    - name: Generate Tasks (Common)
      ansible.builtin.template:
        src: "{{ task_src_dir }}/common/{{ item }}.yml.j2"
        dest: "{{ task_target_dir }}/{{ item }}.yaml"
      with_items:
        - mas-config-helper

    # 10. Generate Tasks (GitOps)
    # -------------------------------------------------------------------------
    - name: Generate Tasks (GitOps)
      ansible.builtin.template:
        src: "{{ task_src_dir }}/gitops/{{ item }}.yml.j2"
        dest: "{{ task_target_dir }}/{{ item }}.yaml"
      with_items:
        - gitops-bootstrap
        - gitops-cis-compliance
        - gitops-cluster
        - gitops-cos
        - gitops-cp4d
        - gitops-cp4d-service
        - gitops-db2u
        - gitops-db2u-database
        - gitops-delete-jdbc-config
        - gitops-delete-kafka-config
        - gitops-deprovision-app-config
        - gitops-deprovision-app-install
        - gitops-deprovision-cluster
        - gitops-deprovision-customer-subscription
        - gitops-deprovision-cos
        - gitops-deprovision-cp4d
        - gitops-deprovision-cp4d-service
        - gitops-deprovision-db2u
        - gitops-deprovision-db2u-database
        - gitops-deprovision-efs
        - gitops-deprovision-kafka
        - gitops-deprovision-mongo
        - gitops-deprovision-rosa
        - gitops-deprovision-suite-config
        - gitops-deprovision-suite-idp-config
        - gitops-deprovision-suite-objectstorage-config
        - gitops-deprovision-suite-smtp-config
        - gitops-deprovision-suite-sendgrid-subuser
        - gitops-deprovision-suite-watson-studio-config
        - gitops-deprovision-suite-workspace
        - gitops-deprovision-suite
        - gitops-dro
        - gitops-efs
        - gitops-jdbc-config
        - gitops-kafka
        - gitops-kafka-config
        - gitops-license
        - gitops-license-generator
        - gitops-mas-fvt-preparer
        - gitops-mas-initiator
        - gitops-mas-provisioner
        - gitops-mongo
        - gitops-nvidia-gpu
        - gitops-process-mongo-user
        - gitops-rosa
        - gitops-sls
        - gitops-suite-app-install
        - gitops-suite-app-config
        - gitops-suite-certs
        - gitops-suite-config
        - gitops-suite-dns
        - gitops-suite-idp-config
        - gitops-suite-objectstorage-config
        - gitops-suite-smtp-config
        - gitops-suite-smtp-config-sendgrid
        - gitops-suite-watson-studio-config
        - gitops-suite-workspace
        - gitops-suite
        - gitops-odh
        - gitops-deprovision-odh
        - gitops-aiservice
        - gitops-aiservice-tenant
        - gitops-deprovision-aiservice-tenant
        - gitops-deprovision-aiservice
        - gitops-app-config
        - gitops-delete-app-config
        - gitops-iac-create-branch
        - gitops-iac-generate-common-files
        - gitops-iac-manage-pr
        - gitops-iac-provision-efs
        - gitops-iac-provision-s3

