#!/bin/bash

function pipeline_install_operator() {
  # Install pipelines support
  echo
  echo_h2 "2. Install OpenShift Pipelines Operator"
  oc apply -f $DIR/templates/subscription.yaml &>> $LOGFILE

  echo -en "\033[s" # Save cursor position
  echo -n "Installing OpenShift Pipelines Operator ..."

  oc get crd tasks.tekton.dev  &>> $LOGFILE
  LOOKUP_RESULT=$?
  while [ "$LOOKUP_RESULT" == "1" ]; do
    echo "Waiting 5s for tasks.tekton.dev CRD to be installed before checking again ..."  &>> $LOGFILE
    sleep 5
    oc get crd tasks.tekton.dev  &>> $LOGFILE
    LOOKUP_RESULT=$?
  done

  echo "Wait for Pipeline operator to be ready" &>> $LOGFILE
  oc wait --for=condition=Established  crd tasks.tekton.dev  --timeout=30m  &>> $LOGFILE

  echo -en "\033[1K" # Clear current line
  echo -en "\033[u" # Restore cursor position
  echo "${COLOR_GREEN}OpenShift Pipelines Operator is installed and ready${COLOR_RESET}"
  echo
}