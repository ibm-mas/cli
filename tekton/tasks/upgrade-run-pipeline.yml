---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: mas-upgrade-run-pipeline
spec:
  params:    
    # Pipeline Run Common Parameters
    - name: pipelinerun_template_file_name
      type: string
      description: name of the pipelinerun template (.yml.j2)
      default: install
    - name: pipelinerun_timeout
      type: string
      description: pipelinerun timeout
      default: 10h
    - name: fvt_image_registry
      type: string
      description: registry where test images live

    # Upgrade Parameters
    # Skip Compatiblity Check
    - name: skip_compatibility_check
      type: string
      default: "False"

  stepTemplate:
    name: 'run-pipeline-$(params.pipeline_name)'
    env:
      - name: PIPELINERUN_TEMPLATE_FILE_NAME
        value: $(params.pipelinerun_template_file_name)
      - name: PIPELINERUN_TIMEOUT
        value: $(params.pipelinerun_timeout)
      - name: PIPELINERUN_WAIT
        value: "true"

      - name: SKIP_COMPATIBILITY_CHECK
        value: $(params.skip_compatibility_check)

  steps:
    # It uses pipeline_name to know what pipeline to run
    - name: run-pipeline
      command:
        - /opt/app-root/src/run-pipeline.sh
      image: '$(params.fvt_image_registry)/mas-devops/ansible-fvt:20.0.0-pre.coderefactor'
      imagePullPolicy: Always
