- name: cv-core
  {{ lookup('template', 'taskdefs/ivt-core/common/taskref.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/ivt-core/common/params.yml.j2') | indent(4) }}
    - name: product_id
      value: ibm-mas
    - name: product_channel
      value: $(params.mas_channel)
    - name: test_suite
      value: contentverification
  when:
    - input: "$(params.ivt_digest_core)"
      operator: notin
      values: [""]

# Core FVT 1.0 coreidp-auth ~20m - Refresh token and authentication patterns
# We are running this test first since it happens to set the Suite accessTokenTimeout from the default of 30m to 12h
# This prevents subsequent test suites that take >30 mins from hitting unexpected 401s due to tokens generated by
# session-scoped fixtures expiring before the tests complete.
# This is temporary workaround, the proper fix is to make the accessTokenTimeout field configurable during install
# See wiotp/tracker#12929 for details
- name: fvt-coreidp-auth
  {{ lookup('template', 'taskdefs/fvt-core/common/taskref.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-core/common/params.yml.j2') | indent(4) }}
    - name: test_suite
      value: coreidp-auth
  runAfter:
    - cv-core

# Core FVT 1.1 coreapi-addons ~20m
- name: fvt-coreapi-addons
  {{ lookup('template', 'taskdefs/fvt-core/common/taskref.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-core/common/params.yml.j2') | indent(4) }}
    - name: test_suite
      value: coreapi-addons
  runAfter:
    - fvt-coreidp-auth

# Core FVT 1.2 coreapi-groupmgmt ~30m
- name: fvt-coreapi-groupmgmt
  {{ lookup('template', 'taskdefs/fvt-core/common/taskref.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-core/common/params.yml.j2') | indent(4) }}
    - name: test_suite
      value: coreapi-groupmgmt
  runAfter:
    - fvt-coreidp-auth

# Core FVT 1.3 coreapi-usermgmt ~15m
- name: fvt-coreapi-usermgmt
  {{ lookup('template', 'taskdefs/fvt-core/common/taskref.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-core/common/params.yml.j2') | indent(4) }}
    - name: test_suite
      value: coreapi-usermgmt
  runAfter:
    - fvt-coreidp-auth

# Core FVT 1.4 coreapi-apikeymgmt ~3m
- name: fvt-coreapi-apikeymgmt
  {{ lookup('template', 'taskdefs/fvt-core/common/taskref.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-core/common/params.yml.j2') | indent(4) }}
    - name: test_suite
      value: coreapi-apikeymgmt
  runAfter:
    - fvt-coreidp-auth

# Core FVT 1.5 coreapi-workspacemgmt  ~35m
- name: fvt-coreapi-workspacemgmt
  {{ lookup('template', 'taskdefs/fvt-core/common/taskref.yml.j2') | indent(2) }}
  params:
    - name: test_suite
      value: coreapi-workspacemgmt
    {{ lookup('template', 'taskdefs/fvt-core/common/params.yml.j2') | indent(4) }}
  runAfter:
    - fvt-coreidp-auth

# Core FVT 1.6 coreapi-graphiteconfigtool  ~15m
- name: fvt-coreapi-graphiteconfigtool
  {{ lookup('template', 'taskdefs/fvt-core/common/taskref.yml.j2') | indent(2) }}
  params:
    - name: test_suite
      value: coreapi-graphiteconfigtool
    {{ lookup('template', 'taskdefs/fvt-core/common/params.yml.j2') | indent(4) }}
  runAfter:
    - fvt-coreidp-auth

# Core FVT 1.7 useractivation-overall  ~8m
- name: fvt-useractivation-overall
  {{ lookup('template', 'taskdefs/fvt-core/common/taskref.yml.j2') | indent(2) }}
  params:
    - name: test_suite
      value: useractivation-overall
    {{ lookup('template', 'taskdefs/fvt-core/common/params.yml.j2') | indent(4) }}
  runAfter:
    - fvt-coreidp-auth

# Core FVT 1.8 useractivation-expiresat  ~20m
- name: fvt-useractivation-expiresat
  {{ lookup('template', 'taskdefs/fvt-core/common/taskref.yml.j2') | indent(2) }}
  params:
    - name: test_suite
      value: useractivation-expiresat
    {{ lookup('template', 'taskdefs/fvt-core/common/params.yml.j2') | indent(4) }}
  runAfter:
    - fvt-coreidp-auth

# Core FVT 1.9 useractivation-inactivity  ~30m
- name: fvt-useractivation-inactivity
  {{ lookup('template', 'taskdefs/fvt-core/common/taskref.yml.j2') | indent(2) }}
  params:
    - name: test_suite
      value: useractivation-inactivity
    {{ lookup('template', 'taskdefs/fvt-core/common/params.yml.j2') | indent(4) }}
  runAfter:
    - fvt-coreidp-auth
