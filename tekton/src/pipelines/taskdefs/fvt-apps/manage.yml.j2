# -------------------------------------------------------------
# PHASE 0
# - fvt-manage-usersync
# -------------------------------------------------------------
# Manage FVT User Sync
- name: fvt-manage-usersync
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage-pytest.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage-pytest.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: usersync
  runAfter:
    - ivtcore-manage

# -------------------------------------------------------------
# PHASE 1
# - fvt-manage-setup
# - fvt-manage-monitoring
# - fvt-manage-security-audit-logging
# - fvt-manage-security-inactive-auth
# -------------------------------------------------------------

# Manage FVT Setup
# Note: Manage Setup and Aviation Setup has a special taskref defintion without fvt_digest_manage criteria. We want to run that even when
# not running the entire FVT suite as applications like Predict and Mobile apps depend on it
- name: fvt-manage-setup # convention: use fvt-manage-<keyword>, as the value of fvt_test_suite parameter
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage-setup.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: setup
    - name: fvt_mas_appws_component
      value: base
    - name: fvt_test_driver
      value: tpae
  runAfter:
    - fvt-manage-aviation-setup # regression tasks depend on fvt-manage-setup or, eventually, any subsequent task in case of Manage Industry Solutions
    - fvt-manage-usersync

# Manage FVT Monitoring
- name: fvt-manage-monitoring
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage-pytest.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage-pytest.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: monitoring
  runAfter:
    - fvt-manage-usersync

# Manage FVT Security Audit Logging
- name: fvt-manage-security-audit-logging
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: security-audit-logging
  runAfter:
    - fvt-manage-usersync

# Manage FVT Inactive User Authentication
- name: fvt-manage-security-inactive-auth
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: security-inactiveuser-authentication
  runAfter:
    - fvt-manage-usersync

# -------------------------------------------------------------
# PHASE 2
# - fvt-manage-masnavigation
# - fvt-manage-classification
# - fvt-manage-helplinks
# - fvt-manage-mif-setup
# - fvt-manage-directprint-reports
# - fvt-manage-metrics-api
# -------------------------------------------------------------

# Manage FVT Mas Navigation Scenario
- name: fvt-manage-masnavigation
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: masnavigation
  runAfter:
    - fvt-manage-setup
    - fvt-manage-monitoring
    - fvt-manage-security-audit-logging
    - fvt-manage-security-inactive-auth

# Manage FVT Classification
- name: fvt-manage-classification
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: classification
  runAfter:
    - fvt-manage-setup
    - fvt-manage-monitoring
    - fvt-manage-security-audit-logging
    - fvt-manage-security-inactive-auth

# Manage FVT Help Links
- name: fvt-manage-helplinks
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: helplinks
  runAfter:
    - fvt-manage-setup
    - fvt-manage-monitoring
    - fvt-manage-security-audit-logging
    - fvt-manage-security-inactive-auth

# Manage MIF setup
- name: fvt-manage-mif-setup
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: mif-setup
  runAfter:
    - fvt-manage-setup
    - fvt-manage-monitoring
    - fvt-manage-security-audit-logging
    - fvt-manage-security-inactive-auth

# Manage BIRT Report > Direct Print for Assets, JP and PO
- name: fvt-manage-directprint-reports
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: directprint-reports
  # Update runAfter list with new PHASE 4 tests
  runAfter:
    - fvt-manage-setup
    - fvt-manage-monitoring
    - fvt-manage-security-audit-logging
    - fvt-manage-security-inactive-auth

# Manage FVT Metrics API
- name: fvt-manage-metrics-api
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: metrics-api
  runAfter:
    - fvt-manage-setup
    - fvt-manage-monitoring
    - fvt-manage-security-audit-logging
    - fvt-manage-security-inactive-auth
  
# -------------------------------------------------------------
# PHASE 3
# - fvt-manage-wobasic
# - fvt-manage-escalation-action
# - fvt-manage-autoscript-adddeletewo
# - fvt-manage-jms-inbound
# - fvt-manage-esig-basic
# - fvt-manage-wo-attach-docs
# -------------------------------------------------------------

# Manage FVT Work Order Basic Scenario
- name: fvt-manage-wobasic
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: workorderbasic
  runAfter:
    - fvt-manage-masnavigation
    - fvt-manage-classification
    - fvt-manage-helplinks
    - fvt-manage-mif-setup
    - fvt-manage-directprint-reports
    - fvt-manage-metrics-api

# Manage FVT Escalation
- name: fvt-manage-escalation-action
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: escalation-action
  runAfter:
    - fvt-manage-masnavigation
    - fvt-manage-classification
    - fvt-manage-helplinks
    - fvt-manage-mif-setup
    - fvt-manage-directprint-reports
    - fvt-manage-metrics-api
    
  # Manage FVT AutoScript to Add Delete WorkOrder
- name: fvt-manage-autoscript-adddeletewo
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: autoscript-adddeletewo
  runAfter:
    - fvt-manage-masnavigation
    - fvt-manage-classification
    - fvt-manage-helplinks
    - fvt-manage-mif-setup
    - fvt-manage-directprint-reports
    - fvt-manage-metrics-api

# Manage JMS Integration - Inbound
- name: fvt-manage-jms-inbound
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: mif-jms-inbound
  runAfter:
    - fvt-manage-masnavigation
    - fvt-manage-classification
    - fvt-manage-helplinks
    - fvt-manage-mif-setup
    - fvt-manage-directprint-reports
    - fvt-manage-metrics-api

# Manage FVT E-Signature Basic Scenario
- name: fvt-manage-esig-basic
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: esig-basic
  runAfter:
    - fvt-manage-masnavigation
    - fvt-manage-classification
    - fvt-manage-helplinks
    - fvt-manage-mif-setup
    - fvt-manage-directprint-reports
    - fvt-manage-metrics-api

# Manage FVT Work Order Attachments
- name: fvt-manage-wo-attach-docs
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: wo-configure-attach-docs
  runAfter:
    - fvt-manage-masnavigation
    - fvt-manage-classification
    - fvt-manage-helplinks
    - fvt-manage-mif-setup
    - fvt-manage-directprint-reports
    - fvt-manage-metrics-api


# -------------------------------------------------------------
# LAST PHASE (in sequence)
# - fvt-manage-application-designer
# - fvt-manage-startcenter-config
# - fvt-manage-workflow-designer
# - fvt-manage-smtp-setup
# -------------------------------------------------------------

# Manage FVT Application Designer
- name: fvt-manage-application-designer
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: application-designer
  runAfter:
    - fvt-manage-wobasic
    - fvt-manage-escalation-action
    - fvt-manage-autoscript-adddeletewo
    - fvt-manage-jms-inbound
    - fvt-manage-esig-basic
    - fvt-manage-wo-attach-docs

# Manage FVT Start Center
- name: fvt-manage-startcenter-config
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: startcenter-config
  runAfter:
    - fvt-manage-application-designer

# Manage FVT Create Workflow Design & Approve WO Assignments
- name: fvt-manage-workflow-designer
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: workflow-designer
  # Update runAfter list with new PHASE 4 tests
  runAfter:
    - fvt-manage-startcenter-config

# Manage SMTP Configuration Validation
# Note: Keep SMTP as the LAST task running for Manage FVT
- name: fvt-manage-smtp-setup
  {{ lookup('template', 'taskdefs/fvt-apps/common/taskref-manage.yml.j2') | indent(2) }}
  params:
    {{ lookup('template', 'taskdefs/fvt-apps/common/params-manage.yml.j2') | indent(4) }}
    - name: fvt_test_suite
      value: mas-smtp-setup
  # Update runAfter list with new PHASE 4 tests
  runAfter:
    - fvt-manage-workflow-designer
